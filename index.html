<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cocktail Recipe Generator</title>
  <meta name="description" content="Pick your base spirit(s) + a couple preferences and get a cocktail recipe. Save favorites and regenerate with the same criteria." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%237946ff' d='M10 10h80v10L55 55v20a5 5 0 0 1-10 0V55L10 20z'/%3E%3Ccircle cx='50' cy='85' r='6' fill='%23999'/%3E%3C/svg%3E" />
  <!-- Tailwind Play CDN for simple GitHub Pages hosting (no build step) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Extra tiny tweaks outside Tailwind */
    .tag { @apply inline-flex items-center rounded-full border px-2 py-0.5 text-xs font-medium mr-1 mb-1; }
    .chip { @apply inline-flex items-center rounded-full bg-gray-100 px-2.5 py-1 text-xs font-medium mr-2 mb-2; }
    .btn { @apply inline-flex items-center gap-2 rounded-2xl px-4 py-2 font-semibold shadow-sm active:scale-95 transition; }
    .btn-primary { @apply bg-violet-600 text-white hover:bg-violet-700; }
    .btn-ghost { @apply bg-white text-gray-700 border hover:bg-gray-50; }
    .btn-danger { @apply bg-rose-600 text-white hover:bg-rose-700; }
    .card { @apply rounded-3xl border bg-white shadow-md; }
    .section { @apply rounded-2xl border bg-white/60 backdrop-blur-sm; }
    .input { @apply w-full rounded-xl border px-3 py-2; }
    .select { @apply w-full rounded-xl border px-3 py-2 bg-white; }
    .kbd { @apply inline-flex items-center rounded-md border px-2 py-0.5 text-xs font-mono bg-gray-50; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-violet-50 text-slate-800">
  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 border-b">
    <div class="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-xl bg-gradient-to-br from-violet-600 to-fuchsia-500 grid place-items-center text-white font-black">üç∏</div>
        <div>
          <h1 class="text-xl font-extrabold tracking-tight">Cocktail Recipe Generator</h1>
          <p class="text-xs text-gray-500">Pick a base spirit (or two), set vibes, get a drink.</p>
        </div>
      </div>
      <nav class="flex items-center gap-2 text-sm">
        <button id="favoritesTabBtn" class="btn btn-ghost">‚òÖ Favorites</button>
        <a class="btn btn-ghost" href="#how-it-works">How it works</a>
        <a class="btn btn-ghost" href="https://github.com/new" target="_blank" rel="noopener">Deploy</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-6 grid gap-6 lg:grid-cols-5">
    <!-- Controls -->
    <section class="section p-4 lg:col-span-2">
      <h2 class="text-lg font-bold mb-3">Your criteria</h2>
      <div class="grid gap-4">
        <!-- Base spirits -->
        <div>
          <label class="font-semibold">Base spirit (pick 1‚Äì2)</label>
          <div id="baseSpirits" class="mt-2 grid grid-cols-2 gap-2 sm:grid-cols-3">
            <!-- checkboxes injected by JS -->
          </div>
          <p class="mt-1 text-xs text-gray-500">Tip: <span class="kbd">Shift</span>+Click selects quickly.</p>
        </div>

        <!-- Style (vibe) -->
        <div>
          <label for="style" class="font-semibold">Style</label>
          <select id="style" class="select mt-2">
            <option value="any">Any</option>
            <option value="spirit-forward">Spirit-forward</option>
            <option value="citrusy">Citrusy / Sour</option>
            <option value="bubbly">Bubbly</option>
            <option value="tiki">Tropical / Tiki</option>
            <option value="bitter">Bitter / Amaro</option>
            <option value="dessert">Dessert / Creamy</option>
            <option value="herbal">Herbal</option>
          </select>
        </div>

        <!-- Sweetness -->
        <div>
          <label for="sweetness" class="font-semibold">Sweetness</label>
          <select id="sweetness" class="select mt-2">
            <option value="any">Any</option>
            <option value="dry">Dry</option>
            <option value="balanced">Balanced</option>
            <option value="sweet">Sweet</option>
          </select>
        </div>

        <!-- Effort -->
        <div>
          <label for="effort" class="font-semibold">Effort</label>
          <select id="effort" class="select mt-2">
            <option value="any">Any</option>
            <option value="quick">Quick (‚â§ 4 ingredients)</option>
            <option value="standard">Standard (5‚Äì6)</option>
            <option value="fancy">Fancy (7+)</option>
          </select>
        </div>

        <div class="flex flex-wrap gap-2 pt-1">
          <button id="generateBtn" class="btn btn-primary">Generate recipe</button>
          <button id="regenBtn" class="btn btn-ghost" disabled>‚Üª Regenerate</button>
          <button id="resetBtn" class="btn btn-ghost">Reset</button>
        </div>
      </div>
    </section>

    <!-- Output -->
    <section class="lg:col-span-3 grid gap-4">
      <div id="result" class="card p-5 hidden"></div>
      <div id="noResult" class="section p-5 hidden">
        <h3 class="font-bold">No exact matches.</h3>
        <p class="text-sm text-gray-600 mt-1">Try loosening criteria, or consider these near-misses:</p>
        <div id="nearMisses" class="mt-3 grid gap-3"></div>
      </div>

      <section id="favoritesPanel" class="section p-4 hidden">
        <div class="flex items-center justify-between">
          <h3 class="font-bold">‚òÖ Your favorites</h3>
          <div class="flex items-center gap-2">
            <button id="exportFavsBtn" class="btn btn-ghost">Export JSON</button>
            <label class="btn btn-ghost cursor-pointer">Import JSON
              <input id="importFavsInput" type="file" accept="application/json" class="hidden" />
            </label>
          </div>
        </div>
        <div id="favoritesList" class="mt-3 grid sm:grid-cols-2 gap-3"></div>
      </section>

      <section id="how-it-works" class="section p-4">
        <h2 class="text-lg font-bold">How it works</h2>
        <ul class="list-disc pl-6 text-sm text-gray-700 mt-2 space-y-1">
          <li>Pick up to two base spirits, plus a couple preferences. Hit <strong>Generate</strong>.</li>
          <li>Don‚Äôt love it? Tap <strong>Regenerate</strong> to spin another that fits the same criteria.</li>
          <li>Click <strong>‚òÖ Favorite</strong> to save a recipe to your device (local-only). Export/Import as JSON to share.</li>
          <li>Share a link with your selections‚Äîyour picks are embedded in the URL.</li>
          <li>100% client-side. Host on GitHub Pages by dropping this file in a repo as <code>index.html</code>.</li>
        </ul>
      </section>
    </section>
  </main>

  <footer class="mx-auto max-w-6xl px-4 py-8 text-center text-xs text-gray-500">
    Built with üçπ and vanilla JS. No tracking. Edit/extend recipes in the source.
  </footer>

<script>
/***********************\
*  DATA & UTILITIES     *
\***********************/
const SPIRITS = [
  'bourbon','rye','scotch','irish whiskey','rum','jamaican rum','overproof rum','tequila','mezcal','gin','vodka','brandy','cognac','pisco','calvados','aperol','campari','amaro','swedish punsch','coffee liqueur','triple sec','cura√ßao','chartreuse green','chartreuse yellow','vermouth sweet','vermouth dry','champagne','prosecco']
  .map(s => ({ id: s, label: titleCase(s) }));

// Map sub-types back to their umbrella for base matching
const BASE_NORMALIZE = {
  'jamaican rum': 'rum',
  'overproof rum': 'rum',
  'cognac': 'brandy',
};

function normBase(b){ return BASE_NORMALIZE[b] || b; }

// Sweetness buckets
function sweetnessFromCount(n){ if(n <= 4) return 'dry'; if(n <= 6) return 'balanced'; return 'sweet'; }

function titleCase(s){ return s.replace(/\b\w/g, c => c.toUpperCase()); }

function tagPill(text){
  return `<span class="tag border-gray-300 text-gray-700 bg-white">${text}</span>`;
}

function randomOf(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function slugify(s){
  return s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
}

/***********************\
*  RECIPE CATALOG       *
\***********************/
// Minimal, opinionated specs. Edit freely!
const RECIPES = [
  {
    name: 'Old Fashioned',
    id: 'old-fashioned',
    base: ['bourbon','rye'],
    profile: ['spirit-forward','aromatic'],
    sweetness: 'dry',
    ingredients: [
      ['2 oz','Bourbon or rye'],
      ['1 tsp','Demerara syrup (2:1)'],
      ['2 dashes','Angostura bitters']
    ],
    method: 'Stir with ice 20‚Äì30 sec. Strain over a large cube.',
    glass: 'Rocks',
    garnish: 'Expressed orange peel',
    tags: ['classic','stirred']
  },
  {
    name: 'Manhattan',
    id: 'manhattan',
    base: ['rye','bourbon'],
    profile: ['spirit-forward','aromatic'],
    sweetness: 'dry',
    ingredients: [
      ['2 oz','Rye or bourbon'],
      ['1 oz','Sweet vermouth'],
      ['2 dashes','Angostura bitters']
    ],
    method: 'Stir with ice, strain into a chilled coupe.',
    glass: 'Coupe',
    garnish: 'Brandied cherry',
    tags: ['classic','stirred']
  },
  {
    name: 'Martini (Gin)',
    id: 'martini-gin',
    base: ['gin'],
    profile: ['spirit-forward','aromatic'],
    sweetness: 'dry',
    ingredients: [
      ['2.5 oz','Gin'],
      ['0.5 oz','Dry vermouth'],
      ['1 dash','Orange bitters (optional)']
    ],
    method: 'Stir with ice, strain into a chilled coupe.',
    glass: 'Coupe',
    garnish: 'Lemon twist or olive',
    tags: ['classic','stirred']
  },
  {
    name: 'Vodka Martini',
    id: 'martini-vodka',
    base: ['vodka'],
    profile: ['spirit-forward'],
    sweetness: 'dry',
    ingredients: [
      ['2.5 oz','Vodka'],
      ['0.5 oz','Dry vermouth']
    ],
    method: 'Stir (or shake) with ice, strain into a chilled coupe.',
    glass: 'Coupe',
    garnish: 'Lemon twist',
    tags: ['classic']
  },
  {
    name: 'Margarita',
    id: 'margarita',
    base: ['tequila'],
    profile: ['citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Tequila blanco'],
      ['1 oz','Lime juice'],
      ['0.75 oz','Triple sec (or cura√ßao)']
    ],
    method: 'Shake with ice, strain over fresh ice or up.',
    glass: 'Rocks or Coupe',
    garnish: 'Salt rim, lime wheel',
    tags: ['sour','shaken']
  },
  {
    name: 'Daiquiri',
    id: 'daiquiri',
    base: ['rum'],
    profile: ['citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','White rum'],
      ['1 oz','Lime juice'],
      ['0.75 oz','Simple syrup']
    ],
    method: 'Shake with ice, strain into a chilled coupe.',
    glass: 'Coupe',
    garnish: 'None needed',
    tags: ['sour','shaken']
  },
  {
    name: 'Whiskey Sour',
    id: 'whiskey-sour',
    base: ['bourbon'],
    profile: ['citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Bourbon'],
      ['0.75 oz','Lemon juice'],
      ['0.75 oz','Simple syrup'],
      ['1','Egg white (optional)']
    ],
    method: 'Shake (dry if using egg), then with ice. Strain over fresh ice.',
    glass: 'Rocks',
    garnish: 'Angostura dash art',
    tags: ['sour','shaken']
  },
  {
    name: 'Tom Collins',
    id: 'tom-collins',
    base: ['gin'],
    profile: ['bubbly','citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Gin'],
      ['0.75 oz','Lemon juice'],
      ['0.75 oz','Simple syrup'],
      ['Top','Soda water']
    ],
    method: 'Build over ice, gentle stir, top with soda.',
    glass: 'Collins',
    garnish: 'Lemon wheel, cherry',
    tags: ['highball','built']
  },
  {
    name: 'Negroni',
    id: 'negroni',
    base: ['gin'],
    profile: ['bitter','spirit-forward'],
    sweetness: 'balanced',
    ingredients: [
      ['1 oz','Gin'],
      ['1 oz','Campari'],
      ['1 oz','Sweet vermouth']
    ],
    method: 'Stir with ice, strain over a large cube or serve up.',
    glass: 'Rocks or Coupe',
    garnish: 'Orange peel',
    tags: ['classic','stirred']
  },
  {
    name: 'Boulevardier',
    id: 'boulevardier',
    base: ['bourbon'],
    profile: ['bitter','spirit-forward'],
    sweetness: 'balanced',
    ingredients: [
      ['1.5 oz','Bourbon'],
      ['1 oz','Campari'],
      ['1 oz','Sweet vermouth']
    ],
    method: 'Stir with ice, strain into coupe or over a big cube.',
    glass: 'Coupe or Rocks',
    garnish: 'Orange peel',
    tags: ['stirred']
  },
  {
    name: 'Paper Plane',
    id: 'paper-plane',
    base: ['bourbon'],
    profile: ['bitter','citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['0.75 oz','Bourbon'],
      ['0.75 oz','Aperol'],
      ['0.75 oz','Amaro Nonino (or similar)'],
      ['0.75 oz','Lemon juice']
    ],
    method: 'Shake with ice, strain into a coupe.',
    glass: 'Coupe',
    garnish: 'Lemon twist (optional)',
    tags: ['modern','shaken']
  },
  {
    name: 'Last Word',
    id: 'last-word',
    base: ['gin'],
    profile: ['herbal','citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['0.75 oz','Gin'],
      ['0.75 oz','Green Chartreuse'],
      ['0.75 oz','Maraschino liqueur'],
      ['0.75 oz','Lime juice']
    ],
    method: 'Shake with ice, strain into a coupe.',
    glass: 'Coupe',
    garnish: 'None',
    tags: ['shaken']
  },
  {
    name: 'Corpse Reviver No. 2',
    id: 'corpse-reviver-2',
    base: ['gin'],
    profile: ['citrusy','herbal'],
    sweetness: 'balanced',
    ingredients: [
      ['0.75 oz','Gin'],
      ['0.75 oz','Cointreau'],
      ['0.75 oz','Lillet Blanc (or Cocchi Americano)'],
      ['0.75 oz','Lemon juice'],
      ['Rinse','Absinthe']
    ],
    method: 'Shake with ice, strain into an absinthe-rinsed coupe.',
    glass: 'Coupe',
    garnish: 'Cherry (optional)',
    tags: ['classic','shaken']
  },
  {
    name: 'French 75',
    id: 'french-75',
    base: ['gin'],
    profile: ['bubbly','citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['1 oz','Gin'],
      ['0.5 oz','Lemon juice'],
      ['0.5 oz','Simple syrup'],
      ['Top','Champagne']
    ],
    method: 'Shake first three with ice, strain into flute, top with Champagne.',
    glass: 'Flute',
    garnish: 'Lemon twist',
    tags: ['sparkling']
  },
  {
    name: 'Mojito',
    id: 'mojito',
    base: ['rum'],
    profile: ['citrusy','herbal'],
    sweetness: 'sweet',
    ingredients: [
      ['2 oz','White rum'],
      ['0.75 oz','Lime juice'],
      ['0.5 oz','Simple syrup'],
      ['8‚Äì10','Mint leaves'],
      ['Top','Soda water']
    ],
    method: 'Lightly muddle mint with syrup, add rum & lime, ice, top with soda.',
    glass: 'Collins',
    garnish: 'Mint bouquet',
    tags: ['highball']
  },
  {
    name: 'Mai Tai',
    id: 'mai-tai',
    base: ['rum','jamaican rum'],
    profile: ['tiki','citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Aged rum (split base encouraged)'],
      ['0.75 oz','Lime juice'],
      ['0.5 oz','Orange cura√ßao'],
      ['0.25 oz','Orgeat'],
      ['0.25 oz','Demerara syrup']
    ],
    method: 'Shake, dump into rocks with crushed ice.',
    glass: 'Rocks',
    garnish: 'Mint, spent lime shell',
    tags: ['tiki','shaken']
  },
  {
    name: 'Jungle Bird',
    id: 'jungle-bird',
    base: ['rum'],
    profile: ['tiki','bitter'],
    sweetness: 'balanced',
    ingredients: [
      ['1.5 oz','Dark rum'],
      ['0.75 oz','Campari'],
      ['1.5 oz','Pineapple juice'],
      ['0.5 oz','Lime juice'],
      ['0.5 oz','Demerara syrup']
    ],
    method: 'Shake with ice, strain over fresh ice.',
    glass: 'Rocks',
    garnish: 'Pineapple frond',
    tags: ['tiki','shaken']
  },
  {
    name: 'Paloma',
    id: 'paloma',
    base: ['tequila'],
    profile: ['bubbly','citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Tequila blanco'],
      ['0.5 oz','Lime juice'],
      ['Top','Grapefruit soda']
    ],
    method: 'Build over ice, gentle stir.',
    glass: 'Highball',
    garnish: 'Salt rim, grapefruit wedge',
    tags: ['highball']
  },
  {
    name: 'Old Cuban',
    id: 'old-cuban',
    base: ['rum'],
    profile: ['bubbly','herbal'],
    sweetness: 'balanced',
    ingredients: [
      ['1.5 oz','Aged rum'],
      ['0.75 oz','Lime juice'],
      ['0.75 oz','Simple syrup'],
      ['6‚Äì8','Mint leaves'],
      ['2 dashes','Angostura bitters'],
      ['Top','Champagne']
    ],
    method: 'Shake (no Champagne), fine strain into coupe, top with Champagne.',
    glass: 'Coupe',
    garnish: 'Mint leaf',
    tags: ['sparkling','shaken']
  },
  {
    name: 'Sazerac',
    id: 'sazerac',
    base: ['rye'],
    profile: ['spirit-forward','aromatic'],
    sweetness: 'dry',
    ingredients: [
      ['2 oz','Rye whiskey'],
      ['0.25 oz','Demerara syrup'],
      ['3 dashes','Peychaud‚Äôs bitters'],
      ['Rinse','Absinthe']
    ],
    method: 'Stir with ice. Rinse chilled glass with absinthe. Strain neat.',
    glass: 'Rocks (no ice)',
    garnish: 'Expressed lemon peel',
    tags: ['new-orleans','stirred']
  },
  {
    name: 'Vieux Carr√©',
    id: 'vieux-carre',
    base: ['rye','cognac'],
    profile: ['spirit-forward','aromatic'],
    sweetness: 'balanced',
    ingredients: [
      ['0.75 oz','Rye'],
      ['0.75 oz','Cognac'],
      ['0.75 oz','Sweet vermouth'],
      ['0.25 oz','B√©n√©dictine'],
      ['2 dashes','Angostura'],
      ['2 dashes','Peychaud‚Äôs']
    ],
    method: 'Stir with ice, strain into rocks with large cube.',
    glass: 'Rocks',
    garnish: 'Orange peel',
    tags: ['classic','stirred']
  },
  {
    name: 'Penicillin',
    id: 'penicillin',
    base: ['scotch'],
    profile: ['citrusy','herbal'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Blended Scotch'],
      ['0.75 oz','Lemon juice'],
      ['0.75 oz','Honey-ginger syrup'],
      ['0.25 oz','Islay Scotch (float)']
    ],
    method: 'Shake first three, strain over ice. Float Islay.',
    glass: 'Rocks',
    garnish: 'Candied ginger',
    tags: ['modern','shaken']
  },
  {
    name: 'Pisco Sour',
    id: 'pisco-sour',
    base: ['pisco'],
    profile: ['citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Pisco'],
      ['1 oz','Lime juice'],
      ['0.75 oz','Simple syrup'],
      ['1','Egg white']
    ],
    method: 'Dry shake, then shake with ice. Strain into coupe.',
    glass: 'Coupe',
    garnish: '3 drops Angostura',
    tags: ['sour','shaken']
  },
  {
    name: 'Sidecar',
    id: 'sidecar',
    base: ['cognac'],
    profile: ['citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Cognac'],
      ['0.75 oz','Cointreau'],
      ['0.75 oz','Lemon juice']
    ],
    method: 'Shake with ice, strain into coupe (sugar rim optional).',
    glass: 'Coupe',
    garnish: 'Orange twist',
    tags: ['classic','shaken']
  },
  {
    name: 'Espresso Martini',
    id: 'espresso-martini',
    base: ['vodka','coffee liqueur'],
    profile: ['dessert'],
    sweetness: 'sweet',
    ingredients: [
      ['1.5 oz','Vodka'],
      ['1 oz','Fresh espresso'],
      ['0.5 oz','Coffee liqueur'],
      ['0.25 oz','Simple syrup (to taste)']
    ],
    method: 'Shake hard with ice, fine strain into coupe.',
    glass: 'Coupe',
    garnish: '3 coffee beans',
    tags: ['modern','shaken']
  },
  {
    name: 'White Russian',
    id: 'white-russian',
    base: ['vodka','coffee liqueur'],
    profile: ['dessert'],
    sweetness: 'sweet',
    ingredients: [
      ['2 oz','Vodka'],
      ['1 oz','Coffee liqueur'],
      ['1 oz','Cream (or alt)']
    ],
    method: 'Build over ice, gentle stir.',
    glass: 'Rocks',
    garnish: 'None',
    tags: ['creamy','built']
  },
  {
    name: 'Moscow Mule',
    id: 'moscow-mule',
    base: ['vodka'],
    profile: ['bubbly','citrusy'],
    sweetness: 'sweet',
    ingredients: [
      ['2 oz','Vodka'],
      ['0.5 oz','Lime juice'],
      ['Top','Ginger beer']
    ],
    method: 'Build over ice, gentle stir.',
    glass: 'Copper mug or Highball',
    garnish: 'Lime wedge',
    tags: ['highball','built']
  },
  {
    name: "Dark 'n Stormy",
    id: 'dark-n-stormy',
    base: ['rum'],
    profile: ['bubbly','citrusy'],
    sweetness: 'sweet',
    ingredients: [
      ['2 oz','Dark rum'],
      ['0.5 oz','Lime juice (optional)'],
      ['Top','Ginger beer']
    ],
    method: 'Build over ice, float rum if desired.',
    glass: 'Highball',
    garnish: 'Lime wedge',
    tags: ['highball','built']
  },
  {
    name: 'Gimlet',
    id: 'gimlet',
    base: ['gin'],
    profile: ['citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Gin'],
      ['0.75 oz','Lime juice'],
      ['0.75 oz','Simple syrup']
    ],
    method: 'Shake with ice, strain into coupe (or stir with lime cordial).',
    glass: 'Coupe',
    garnish: 'Lime wheel',
    tags: ['sour','shaken']
  },
  {
    name: 'Hanky Panky',
    id: 'hanky-panky',
    base: ['gin'],
    profile: ['herbal','spirit-forward'],
    sweetness: 'dry',
    ingredients: [
      ['1.5 oz','Gin'],
      ['1.5 oz','Sweet vermouth'],
      ['0.25 oz','Fernet-Branca']
    ],
    method: 'Stir with ice, strain into coupe.',
    glass: 'Coupe',
    garnish: 'Orange twist',
    tags: ['stirred']
  },
  {
    name: 'Aperol Spritz',
    id: 'aperol-spritz',
    base: ['aperol'],
    profile: ['bubbly','bitter'],
    sweetness: 'sweet',
    ingredients: [
      ['3 oz','Prosecco'],
      ['2 oz','Aperol'],
      ['1 oz','Soda water']
    ],
    method: 'Build over ice in a wine glass.',
    glass: 'Wine',
    garnish: 'Orange slice',
    tags: ['spritz','built']
  },
  {
    name: 'Doctor Cocktail',
    id: 'doctor-cocktail',
    base: ['rum','swedish punsch'],
    profile: ['citrusy','tiki'],
    sweetness: 'balanced',
    ingredients: [
      ['1.5 oz','Swedish Punsch (e.g., Kronan)'],
      ['0.75 oz','Aged rum'],
      ['0.75 oz','Lime juice']
    ],
    method: 'Shake with ice, strain into coupe.',
    glass: 'Coupe',
    garnish: 'Lime wheel',
    tags: ['vintage','shaken']
  },
  {
    name: 'Diki-Diki',
    id: 'diki-diki',
    base: ['calvados','swedish punsch'],
    profile: ['citrusy'],
    sweetness: 'dry',
    ingredients: [
      ['1.5 oz','Calvados'],
      ['0.75 oz','Swedish Punsch'],
      ['0.75 oz','Grapefruit juice']
    ],
    method: 'Shake with ice, strain into coupe.',
    glass: 'Coupe',
    garnish: 'Grapefruit twist',
    tags: ['vintage','shaken']
  },
  {
    name: 'Biffy Cocktail',
    id: 'biffy',
    base: ['gin','swedish punsch'],
    profile: ['citrusy','herbal'],
    sweetness: 'balanced',
    ingredients: [
      ['1.5 oz','Gin'],
      ['0.75 oz','Swedish Punsch'],
      ['0.5 oz','Lemon juice'],
      ['0.25 oz','Simple syrup (to taste)']
    ],
    method: 'Shake with ice, strain into coupe.',
    glass: 'Coupe',
    garnish: 'Lemon twist',
    tags: ['vintage','shaken']
  },
  {
    name: 'Toronto',
    id: 'toronto',
    base: ['rye'],
    profile: ['herbal','spirit-forward'],
    sweetness: 'dry',
    ingredients: [
      ['2 oz','Rye whiskey'],
      ['0.25 oz','Fernet-Branca'],
      ['0.25 oz','Simple syrup'],
      ['2 dashes','Angostura bitters']
    ],
    method: 'Stir with ice, strain into coupe.',
    glass: 'Coupe',
    garnish: 'Orange twist',
    tags: ['stirred']
  },
  {
    name: 'Bramble',
    id: 'bramble',
    base: ['gin'],
    profile: ['citrusy','dessert'],
    sweetness: 'sweet',
    ingredients: [
      ['2 oz','Gin'],
      ['0.75 oz','Lemon juice'],
      ['0.5 oz','Simple syrup'],
      ['0.5 oz','Cr√®me de m√ªre (float)']
    ],
    method: 'Shake first three, strain over crushed ice. Float m√ªre.',
    glass: 'Rocks',
    garnish: 'Blackberries, lemon slice',
    tags: ['modern','shaken']
  },
  {
    name: 'New York Sour',
    id: 'new-york-sour',
    base: ['bourbon'],
    profile: ['citrusy'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Bourbon'],
      ['0.75 oz','Lemon juice'],
      ['0.75 oz','Simple syrup'],
      ['0.5 oz','Dry red wine (float)']
    ],
    method: 'Shake first three, strain over ice. Float red wine.',
    glass: 'Rocks',
    garnish: 'Orange peel (optional)',
    tags: ['shaken']
  },
  {
    name: 'Rum Old Fashioned',
    id: 'rum-old-fashioned',
    base: ['rum'],
    profile: ['spirit-forward'],
    sweetness: 'dry',
    ingredients: [
      ['2 oz','Aged rum'],
      ['1 tsp','Demerara syrup'],
      ['2 dashes','Angostura']
    ],
    method: 'Stir with ice, strain over large cube.',
    glass: 'Rocks',
    garnish: 'Orange peel',
    tags: ['stirred']
  },
  {
    name: "Bee's Knees",
    id: 'bees-knees',
    base: ['gin'],
    profile: ['citrusy','herbal'],
    sweetness: 'balanced',
    ingredients: [
      ['2 oz','Gin'],
      ['0.75 oz','Lemon juice'],
      ['0.75 oz','Honey syrup (1:1)']
    ],
    method: 'Shake with ice, strain into coupe.',
    glass: 'Coupe',
    garnish: 'Lemon twist',
    tags: ['prohibition','shaken']
  },
  {
    name: 'Kingston Negroni',
    id: 'kingston-negroni',
    base: ['jamaican rum'],
    profile: ['bitter','spirit-forward'],
    sweetness: 'balanced',
    ingredients: [
      ['1 oz','Jamaican rum'],
      ['1 oz','Campari'],
      ['1 oz','Sweet vermouth']
    ],
    method: 'Stir with ice, strain over a large cube.',
    glass: 'Rocks',
    garnish: 'Orange peel',
    tags: ['stirred']
  }
];

/***********************\
*  STATE               *
\***********************/
const state = {
  bases: new Set(),
  style: 'any',
  sweetness: 'any',
  effort: 'any',
  lastPool: [],
  lastPick: null,
};

/***********************\
*  INITIALIZE UI        *
\***********************/
const baseWrap = document.getElementById('baseSpirits');
SPIRITS.filter(s => !['aperol','campari','amaro','chartreuse green','chartreuse yellow','vermouth sweet','vermouth dry','champagne','prosecco','triple sec','cura√ßao','coffee liqueur'].includes(s.id))
  .forEach(({id,label}) => {
    const idAttr = `base-${id.replace(/\s+/g,'-')}`;
    const div = document.createElement('div');
    div.innerHTML = `
      <label class="flex items-center gap-2 border rounded-xl px-3 py-2 hover:bg-gray-50 cursor-pointer">
        <input type="checkbox" id="${idAttr}" value="${id}" class="accent-violet-600">
        <span>${label}</span>
      </label>`;
    baseWrap.appendChild(div);
    div.querySelector('input').addEventListener('change', (e) => {
      if (e.target.checked) {
        if (state.bases.size >= 2) {
          // Keep at most two
          const [first] = state.bases; // Set iteration order
          document.getElementById(`base-${first.replace(/\s+/g,'-')}`).checked = false;
          state.bases.delete(first);
        }
        state.bases.add(e.target.value);
      } else {
        state.bases.delete(e.target.value);
      }
      syncUrl();
    });
  });

['style','sweetness','effort'].forEach(id => {
  document.getElementById(id).addEventListener('change', e => { state[id] = e.target.value; syncUrl(); });
});

// Buttons
const generateBtn = document.getElementById('generateBtn');
const regenBtn = document.getElementById('regenBtn');
const resetBtn = document.getElementById('resetBtn');
const favoritesTabBtn = document.getElementById('favoritesTabBtn');
const favoritesPanel = document.getElementById('favoritesPanel');

generateBtn.addEventListener('click', handleGenerate);
regenBtn.addEventListener('click', handleRegenerate);
resetBtn.addEventListener('click', resetAll);
favoritesTabBtn.addEventListener('click', () => {
  favoritesPanel.classList.toggle('hidden');
  renderFavorites();
});

// URL params -> state (for shareable links)
(function hydrateFromUrl(){
  const p = new URLSearchParams(location.search);
  const bases = (p.get('bases')||'').split(',').filter(Boolean);
  bases.slice(0,2).forEach(b => {
    const idAttr = `base-${b.replace(/\s+/g,'-')}`;
    const cb = document.getElementById(idAttr);
    if (cb){ cb.checked = true; state.bases.add(b); }
  });
  ['style','sweetness','effort'].forEach(k => {
    if (p.get(k)){
      state[k] = p.get(k);
      const el = document.getElementById(k); if (el) el.value = state[k];
    }
  });
})();

function syncUrl(){
  const p = new URLSearchParams();
  if (state.bases.size) p.set('bases', Array.from(state.bases).join(','));
  ['style','sweetness','effort'].forEach(k => { if (state[k] !== 'any') p.set(k, state[k]); });
  const newUrl = location.pathname + (p.toString()?`?${p.toString()}`:'');
  history.replaceState(null, '', newUrl);
}

/***********************\
*  CORE LOGIC           *
\***********************/
function matchesCriteria(r){
  // Base spirits: if 1 chosen, must include; if 2 chosen, must include both (normalized)
  const chosen = Array.from(state.bases);
  if (chosen.length){
    const rbases = r.base.map(normBase);
    const needAll = chosen.map(normBase).every(b => rbases.includes(b));
    if (!needAll) return false;
  }
  // Style
  if (state.style !== 'any' && !(r.profile||[]).includes(state.style)) return false;
  // Sweetness (rough heuristic by provided bucket)
  if (state.sweetness !== 'any' && r.sweetness !== state.sweetness) return false;
  // Effort by ingredient count
  const n = r.ingredients.length;
  let bucket = 'standard';
  if (n <= 4) bucket = 'quick';
  else if (n >= 7) bucket = 'fancy';
  if (state.effort !== 'any' && state.effort !== bucket) return false;
  return true;
}

function filterPool(){
  const pool = RECIPES.filter(matchesCriteria);
  return pool;
}

function handleGenerate(){
  const pool = filterPool();
  state.lastPool = pool;
  pickAndRender(pool);
}

function handleRegenerate(){
  if (!state.lastPool.length){ handleGenerate(); return; }
  pickAndRender(state.lastPool.filter(r => !state.lastPick || r.id !== state.lastPick.id));
}

function pickAndRender(pool){
  const resultEl = document.getElementById('result');
  const noResult = document.getElementById('noResult');
  const nearWrap = document.getElementById('nearMisses');

  if (!pool.length){
    // Near misses: match only by base(s)
    const chosen = Array.from(state.bases);
    const near = RECIPES.filter(r => {
      if (!chosen.length) return false;
      const rbases = r.base.map(normBase);
      return chosen.map(normBase).every(b => rbases.includes(b));
    }).slice(0,4);
    nearWrap.innerHTML = near.map(r => smallCard(r)).join('') || '<p class="text-sm text-gray-500">No near matches either‚Äîtry clearing a filter.</p>';
    resultEl.classList.add('hidden');
    noResult.classList.remove('hidden');
    regenBtn.disabled = true;
    return;
  }

  const pick = randomOf(pool);
  state.lastPick = pick;
  resultEl.innerHTML = recipeCard(pick);
  resultEl.classList.remove('hidden');
  document.getElementById('noResult').classList.add('hidden');
  regenBtn.disabled = pool.length <= 1;
  attachRecipeCardHandlers(pick);
}

function smallCard(r){
  return `<div class="card p-3">
    <div class="flex items-center justify-between">
      <h4 class="font-semibold">${r.name}</h4>
      <button data-open="${r.id}" class="text-violet-600 underline">Open</button>
    </div>
    <div class="mt-1 text-xs text-gray-600">${r.profile.map(tagPill).join('')}</div>
  </div>`
}

function recipeCard(r){
  const ingList = r.ingredients.map(([amt,item]) => `<li><span class="font-medium">${amt}</span> ${item}</li>`).join('');
  const base = r.base.map(b => titleCase(normBase(b))).filter((v,i,a)=>a.indexOf(v)===i).join(' + ');
  const n = r.ingredients.length;
  const effort = n<=4?'quick':(n>=7?'fancy':'standard');
  const fav = isFavorite(r.id);
  return `
  <article>
    <div class="flex items-start justify-between gap-4">
      <div>
        <h2 class="text-2xl font-extrabold">${r.name}</h2>
        <p class="text-sm text-gray-600">${base} ‚Ä¢ ${titleCase(r.profile[0]||'')} ‚Ä¢ ${titleCase(r.sweetness)} ‚Ä¢ ${titleCase(effort)}</p>
      </div>
      <div class="flex items-center gap-2">
        <button class="btn btn-ghost" id="shareBtn">Share</button>
        <button class="btn ${fav?'btn-danger':'btn-ghost'}" id="favBtn">${fav?'‚òÖ Remove':'‚òÜ Favorite'}</button>
        <button class="btn btn-primary" id="copyBtn">Copy</button>
      </div>
    </div>

    <div class="grid sm:grid-cols-3 gap-4 mt-4">
      <div class="sm:col-span-2 card p-4">
        <h3 class="font-bold mb-2">Ingredients</h3>
        <ul class="list-disc pl-6">${ingList}</ul>
      </div>
      <div class="card p-4">
        <h3 class="font-bold mb-2">Details</h3>
        <p><span class="font-semibold">Method:</span> ${r.method}</p>
        <p><span class="font-semibold">Glass:</span> ${r.glass}</p>
        ${r.garnish?`<p><span class="font-semibold">Garnish:</span> ${r.garnish}</p>`:''}
        <div class="mt-2">${(r.tags||[]).map(t => `<span class="chip">${t}</span>`).join('')}</div>
      </div>
    </div>
  </article>`;
}

function attachRecipeCardHandlers(r){
  const copyBtn = document.getElementById('copyBtn');
  const favBtn = document.getElementById('favBtn');
  const shareBtn = document.getElementById('shareBtn');

  copyBtn?.addEventListener('click', () => {
    const lines = [
      `${r.name}`,
      '',
      'Ingredients:',
      ...r.ingredients.map(([a,i]) => `‚Ä¢ ${a} ${i}`),
      '',
      `Method: ${r.method}`,
      `Glass: ${r.glass}`,
      r.garnish?`Garnish: ${r.garnish}`:''
    ].filter(Boolean).join('\n');
    navigator.clipboard.writeText(lines).then(()=>{
      toast('Recipe copied to clipboard');
    });
  });

  favBtn?.addEventListener('click', () => {
    toggleFavorite(r.id);
    // re-render button
    document.getElementById('result').innerHTML = recipeCard(r);
    attachRecipeCardHandlers(r);
    renderFavorites();
  });

  shareBtn?.addEventListener('click', () => {
    // Share current URL (contains criteria), plus anchor to recipe id
    const url = location.href.split('#')[0] + '#' + r.id;
    navigator.clipboard.writeText(url).then(()=> toast('Shareable link copied'));
  });
}

/***********************\
*  FAVORITES (local)    *
\***********************/
const FAV_KEY = 'cocktail-favorites-v1';
function getFavorites(){
  try { return JSON.parse(localStorage.getItem(FAV_KEY)||'[]'); } catch { return []; }
}
function isFavorite(id){ return getFavorites().includes(id); }
function toggleFavorite(id){
  const favs = new Set(getFavorites());
  if (favs.has(id)) favs.delete(id); else favs.add(id);
  localStorage.setItem(FAV_KEY, JSON.stringify(Array.from(favs)));
}
function renderFavorites(){
  const wrap = document.getElementById('favoritesList');
  const favs = getFavorites();
  if (!wrap) return;
  const list = RECIPES.filter(r => favs.includes(r.id));
  wrap.innerHTML = list.length ? list.map(r => `
    <div class="card p-3">
      <div class="flex items-center justify-between">
        <h4 class="font-semibold">${r.name}</h4>
        <button class="text-rose-600 underline" data-remove="${r.id}">Remove</button>
      </div>
      <div class="mt-2 text-xs text-gray-600">${r.base.map(b=>titleCase(normBase(b))).join(' + ')} ‚Ä¢ ${r.profile.join(', ')}</div>
      <div class="mt-2"><button class="btn btn-ghost" data-open="${r.id}">Open</button></div>
    </div>`).join('') : '<p class="text-sm text-gray-500">No favorites yet. Mark recipes with ‚òÜ Favorite.</p>';

  wrap.querySelectorAll('[data-remove]').forEach(btn => btn.addEventListener('click', e => {
    toggleFavorite(e.target.getAttribute('data-remove'));
    renderFavorites();
  }));
  wrap.querySelectorAll('[data-open]').forEach(btn => btn.addEventListener('click', e => {
    const id = e.target.getAttribute('data-open');
    const r = RECIPES.find(r => r.id === id);
    if (r){
      document.getElementById('result').innerHTML = recipeCard(r);
      document.getElementById('result').classList.remove('hidden');
      document.getElementById('noResult').classList.add('hidden');
      attachRecipeCardHandlers(r);
      state.lastPick = r;
    }
  }));
}

// Export/Import
const exportFavsBtn = document.getElementById('exportFavsBtn');
const importFavsInput = document.getElementById('importFavsInput');
exportFavsBtn?.addEventListener('click', () => {
  const data = JSON.stringify(getFavorites(), null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = Object.assign(document.createElement('a'), { href: url, download: 'favorites.json' });
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
importFavsInput?.addEventListener('change', (e) => {
  const f = e.target.files?.[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const arr = JSON.parse(reader.result);
      if (Array.isArray(arr)){
        localStorage.setItem(FAV_KEY, JSON.stringify(arr));
        toast('Favorites imported');
        renderFavorites();
      } else throw new Error('Bad JSON');
    } catch {
      toast('Import failed: invalid JSON');
    }
  };
  reader.readAsText(f);
});

/***********************\
*  MISC UI UTILITIES    *
\***********************/
function resetAll(){
  document.querySelectorAll('#baseSpirits input[type=checkbox]').forEach(cb => cb.checked = false);
  state.bases.clear();
  state.style='any'; state.sweetness='any'; state.effort='any';
  document.getElementById('style').value='any';
  document.getElementById('sweetness').value='any';
  document.getElementById('effort').value='any';
  document.getElementById('result').classList.add('hidden');
  document.getElementById('noResult').classList.add('hidden');
  regenBtn.disabled = true;
  syncUrl();
}

function toast(msg){
  const t = document.createElement('div');
  t.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 bg-black text-white text-sm px-4 py-2 rounded-full shadow-lg';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 1800);
}

/***********************\
*  KEYBOARD A11Y        *
\***********************/
window.addEventListener('keydown', (e) => {
  // r to regenerate
  if (e.key.toLowerCase() === 'r' && !e.metaKey && !e.ctrlKey){
    e.preventDefault();
    if (!regenBtn.disabled) handleRegenerate();
  }
});

</script>
</body>
</html>
